<?php

/*=========================================================================
 * Transfer data from existing API_ORDERS database to new FESP MySQL database,
 * and modify so that product details (title, variations, price) no longer
 * need to be added to every order. This has greatly reduced the required
 * database disk space.
 *========================================================================*/

/*
http://localhost/elixirgardens-2022/LVL_FESP/undispatched/transfer_fesp_data_to_mysql.php
*/

ini_set('display_errors', '1');
ini_set('display_startup_errors', '1');
error_reporting(E_ALL);

$db_host = 'localhost';
$db_name = 'FESP';
$db_user = 'root';
$db_pass = '';

$db_mysql = new PDO(
    "mysql:host=$db_host;dbname=$db_name",
    $db_user,
    $db_pass,
    [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        // required to store / display unicode characters correctly - eg. 3m²-700m² (3m\u00b2-700m\u00b2)
        PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8"
    ]
);
$tables = [
    'amazon',
    'ebay',
    'ebay_prosalt',
    'floorworld',
    'onbuy',
    'website',
];


try {
    if ($db_mysql->exec("DROP TABLE IF EXISTS barcode")) {
        echo "Deleted barcode table.<br>";
    }
    
    $sql ="CREATE TABLE `barcode` (
        `barcode`       int(8) NOT NULL,
        `orderId`       varchar(42) UNIQUE NOT NULL,
        `platform`      char(2) NOT NULL,
        `generatedTime` int(10) NOT NULL,
        `statusTime`    int(10) NOT NULL,
        `status`        char(1) NOT NULL, -- v, h, g, m
        `courier`       varchar(14) NOT NULL,
        PRIMARY KEY(`barcode`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
    
    echo "Create barcode table.<br>";
    $db_mysql->exec($sql);

} catch (PDOException $e) {
    echo $e->getMessage();
}

$json_barcode = file('data/json_barcode.php', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

// echo '<pre style="background:#111; color:#b5ce28; font-size:11px;">'; print_r($json_barcode); echo '</pre>'; die();
// echo '<pre style="background:#111; color:#b5ce28; font-size:11px;">'; print_r(json_decode($json_barcode, true)); echo '</pre>'; die();

$barcode_lookup = [
    '026-0050977-9828368' => 1,
    '026-0177135-6212329' => 1,
    '026-0197970-8989130' => 1,
    '026-0206257-7487573' => 1,
    '026-0349001-7741975' => 1,
    '026-0470053-7324352' => 1,
    '026-0602185-9761950' => 1,
    '026-0807759-9692306' => 1,
    '026-0914867-7973105' => 1,
    '026-1073978-8389959' => 1,
    '026-1252630-9557932' => 1,
    '026-1263478-6323525' => 1,
    '026-1297551-4425148' => 1,
    '026-1564934-7262722' => 1,
    '026-1630489-0515509' => 1,
    '026-1636571-0944330' => 1,
    '026-1648381-3795549' => 1,
    '026-1656739-8130732' => 1,
    '026-1748922-3926729' => 1,
    '026-1773580-5029943' => 1,
    '026-1857356-0573935' => 1,
    '026-2116955-0885114' => 1,
    '026-2117409-2780319' => 1,
    '026-2411128-4273921' => 1,
    '026-2663019-0525133' => 1,
    '026-2674576-8325122' => 1,
    '026-2685170-2344357' => 1,
    '026-2691898-0195542' => 1,
    '026-2828053-3468329' => 1,
    '026-2931281-2013967' => 1,
    '026-3017918-3529151' => 1,
    '026-3129530-4512318' => 1,
    '026-3134137-0995551' => 1,
    '026-3208612-2605154' => 1,
    '026-3230400-3733121' => 1,
    '026-3259979-2313117' => 1,
    '026-3295657-8181113' => 1,
    '026-3300944-7762736' => 1,
    '026-3478118-9504306' => 1,
    '026-3719152-2555504' => 1,
    '026-3758345-5329122' => 1,
    '026-3911886-1872351' => 1,
    '026-3952832-1645905' => 1,
    '026-4359585-7926725' => 1,
    '026-4528121-2081925' => 1,
    '026-4713686-0190748' => 1,
    '026-4773493-2354747' => 1,
    '026-4793164-1824346' => 1,
    '026-4848599-2122737' => 1,
    '026-4964084-6503510' => 1,
    '026-5274157-0508340' => 1,
    '026-5312187-2759505' => 1,
    '026-5343293-7804337' => 1,
    '026-5556780-0449104' => 1,
    '026-5615673-2574737' => 1,
    '026-5643693-3526761' => 1,
    '026-5959042-4144314' => 1,
    '026-6170829-9273111' => 1,
    '026-6181537-3021942' => 1,
    '026-6259136-8340353' => 1,
    '026-6382742-4211564' => 1,
    '026-6433182-5344348' => 1,
    '026-6450167-3854706' => 1,
    '026-6505922-0428348' => 1,
    '026-6543431-3308328' => 1,
    '026-6660799-5846740' => 1,
    '026-6802674-1742738' => 1,
    '026-6865410-6229961' => 1,
    '026-6904726-1775522' => 1,
    '026-6913406-8714712' => 1,
    '026-6940393-8554731' => 1,
    '026-7084215-2348328' => 1,
    '026-7130511-6817961' => 1,
    '026-7155117-9865903' => 1,
    '026-7352164-8689921' => 1,
    '026-7437413-4617955' => 1,
    '026-7467846-8425932' => 1,
    '026-7597463-0680360' => 1,
    '026-7718308-5221956' => 1,
    '026-8004552-0426767' => 1,
    '026-8040983-3409151' => 1,
    '026-8088617-8634703' => 1,
    '026-8170443-9674703' => 1,
    '026-8367099-7303532' => 1,
    '026-8476429-6233139' => 1,
    '026-8511812-3502769' => 1,
    '026-8565516-2883527' => 1,
    '026-8653725-4478760' => 1,
    '026-8788080-7083512' => 1,
    '026-8991261-6976339' => 1,
    '026-9211856-8563517' => 1,
    '026-9310187-2374709' => 1,
    '026-9403396-1991560' => 1,
    '026-9560639-3405969' => 1,
    '026-9655635-6210706' => 1,
    '026-9655639-6733958' => 1,
    '026-9971494-9461103' => 1,
    '1249851' => 1,
    '1250475' => 1,
    '1250476' => 1,
    '1250477' => 1,
    '1250478' => 1,
    '1250479' => 1,
    '1250480' => 1,
    '1250481' => 1,
    '1250482' => 1,
    '1250483' => 1,
    '1250484' => 1,
    '1250485' => 1,
    '1250486' => 1,
    '1250487' => 1,
    '1250488' => 1,
    '1250489' => 1,
    '1250490' => 1,
    '1250491' => 1,
    '1250492' => 1,
    '1250493' => 1,
    '1250495' => 1,
    '1250496' => 1,
    '1250497' => 1,
    '1250498' => 1,
    '1250499' => 1,
    '1250500' => 1,
    '1250501' => 1,
    '1250505' => 1,
    '1250506' => 1,
    '1250507' => 1,
    '1250510' => 1,
    '1250511' => 1,
    '1250512' => 1,
    '1250515' => 1,
    '1250516' => 1,
    '1250517' => 1,
    '1250518' => 1,
    '1250519' => 1,
    '1250521' => 1,
    '1250522' => 1,
    '1250523' => 1,
    '1250524' => 1,
    '1250525' => 1,
    '1250526' => 1,
    '1250527' => 1,
    '1250528' => 1,
    '1250529' => 1,
    '1250530' => 1,
    '1250531' => 1,
    '1250532' => 1,
    '1250533' => 1,
    '1250534' => 1,
    '1250535' => 1,
    '1250536' => 1,
    '1250537' => 1,
    '1250538' => 1,
    '1250539' => 1,
    '1250540' => 1,
    '1250541' => 1,
    '1250542' => 1,
    '1250543' => 1,
    '1250544' => 1,
    '1250545' => 1,
    '1250546' => 1,
    '1250547' => 1,
    '1250548' => 1,
    '1250549' => 1,
    '1250552' => 1,
    '1250555' => 1,
    '1250556' => 1,
    '1250557' => 1,
    '1250558' => 1,
    '1250559' => 1,
    '1250560' => 1,
    '1250561' => 1,
    '1250562' => 1,
    '1250563' => 1,
    '1250564' => 1,
    '1250565' => 1,
    '1250569' => 1,
    '1250570' => 1,
    '1250571' => 1,
    '1250572' => 1,
    '1250573' => 1,
    '1250576' => 1,
    '1250577' => 1,
    '1250578' => 1,
    '1250579' => 1,
    '1250580' => 1,
    '1250581' => 1,
    '1250582' => 1,
    '1250583' => 1,
    '1250584' => 1,
    '1250585' => 1,
    '1250586' => 1,
    '1250587' => 1,
    '1250588' => 1,
    '1250589' => 1,
    '1250590' => 1,
    '1250591' => 1,
    '1250592' => 1,
    '1250593' => 1,
    '1250594' => 1,
    '1250595' => 1,
    '1250596' => 1,
    '1250597' => 1,
    '1250598' => 1,
    '1250599' => 1,
    '1250600' => 1,
    '1250601' => 1,
    '1250602' => 1,
    '1250603' => 1,
    '1250604' => 1,
    '1250605' => 1,
    '1250606' => 1,
    '1250607' => 1,
    '1250608' => 1,
    '1250609' => 1,
    '1250610' => 1,
    '1250611' => 1,
    '1250612' => 1,
    '1250613' => 1,
    '1250614' => 1,
    '1250615' => 1,
    '1250616' => 1,
    '1250617' => 1,
    '1250618' => 1,
    '1250619' => 1,
    '1250620' => 1,
    '1250621' => 1,
    '1250622' => 1,
    '1250623' => 1,
    '1250624' => 1,
    '1250625' => 1,
    '1250626' => 1,
    '1250627' => 1,
    '1250628' => 1,
    '1250629' => 1,
    '1250630' => 1,
    '1250631' => 1,
    '1250632' => 1,
    '1250633' => 1,
    '1250634' => 1,
    '1250635' => 1,
    '1250636' => 1,
    '1250637' => 1,
    '1250638' => 1,
    '1250639' => 1,
    '1250640' => 1,
    '1250641' => 1,
    '1250642' => 1,
    '1250643' => 1,
    '1250644' => 1,
    '1250645' => 1,
    '1250646' => 1,
    '1250647' => 1,
    '1250648' => 1,
    '1250649' => 1,
    '1250650' => 1,
    '1250651' => 1,
    '1250652' => 1,
    '1250653' => 1,
    '1250654' => 1,
    '1250655' => 1,
    '1250656' => 1,
    '1250657' => 1,
    '1250658' => 1,
    '1250659' => 1,
    '1250660' => 1,
    '1250661' => 1,
    '1250662' => 1,
    '1250663' => 1,
    '1250664' => 1,
    '1250665' => 1,
    '1250666' => 1,
    '1250667' => 1,
    '1250668' => 1,
    '1250669' => 1,
    '1250670' => 1,
    '1250671' => 1,
    '1250672' => 1,
    '1250673' => 1,
    '1250674' => 1,
    '1250675' => 1,
    '1250676' => 1,
    '1250677' => 1,
    '1250678' => 1,
    '1250679' => 1,
    '1250680' => 1,
    '1250681' => 1,
    '1250682' => 1,
    '1250683' => 1,
    '1250684' => 1,
    '1250685' => 1,
    '1250686' => 1,
    '1250687' => 1,
    '1250688' => 1,
    '1250689' => 1,
    '1250690' => 1,
    '1250691' => 1,
    '1250692' => 1,
    '1250693' => 1,
    '1250694' => 1,
    '1250695' => 1,
    '1250696' => 1,
    '1250697' => 1,
    '1250698' => 1,
    '1250699' => 1,
    '1250700' => 1,
    '1250701' => 1,
    '1250702' => 1,
    '1250703' => 1,
    '1250704' => 1,
    '1250705' => 1,
    '1250706' => 1,
    '1250707' => 1,
    '1250708' => 1,
    '1250709' => 1,
    '1250710' => 1,
    '1250711' => 1,
    '1250712' => 1,
    '1250713' => 1,
    '1250714' => 1,
    '1250715' => 1,
    '1250716' => 1,
    '1250717' => 1,
    '1250718' => 1,
    '1250719' => 1,
    '1250720' => 1,
    '1250721' => 1,
    '1250722' => 1,
    '1250723' => 1,
    '1250724' => 1,
    '1250725' => 1,
    '1250726' => 1,
    '1250727' => 1,
    '1250728' => 1,
    '1250729' => 1,
    '1250730' => 1,
    '1250731' => 1,
    '1250732' => 1,
    '1250733' => 1,
    '1250734' => 1,
    '1250735' => 1,
    '1250736' => 1,
    '1250737' => 1,
    '1250738' => 1,
    '1250739' => 1,
    '1250740' => 1,
    '1250741' => 1,
    '1250742' => 1,
    '1250743' => 1,
    '1250744' => 1,
    '1250745' => 1,
    '1250746' => 1,
    '1250747' => 1,
    '1250748' => 1,
    '1250749' => 1,
    '1250750' => 1,
    '1250751' => 1,
    '1250752' => 1,
    '1250753' => 1,
    '1250754' => 1,
    '1250755' => 1,
    '1250756' => 1,
    '1250757' => 1,
    '1250758' => 1,
    '1250759' => 1,
    '1250760' => 1,
    '1250761' => 1,
    '1250762' => 1,
    '1250763' => 1,
    '1250764' => 1,
    '1250765' => 1,
    '1250766' => 1,
    '1250767' => 1,
    '1250768' => 1,
    '1250769' => 1,
    '1250770' => 1,
    '1250771' => 1,
    '1250772' => 1,
    '1250773' => 1,
    '1250774' => 1,
    '1250775' => 1,
    '1250776' => 1,
    '1250777' => 1,
    '1250778' => 1,
    '1250779' => 1,
    '1250780' => 1,
    '1250781' => 1,
    '1250782' => 1,
    '1250783' => 1,
    '1250784' => 1,
    '1250785' => 1,
    '1250786' => 1,
    '1250787' => 1,
    '1250788' => 1,
    '1250789' => 1,
    '1250790' => 1,
    '196822' => 1,
    '197660' => 1,
    '197677' => 1,
    '197706' => 1,
    '197723' => 1,
    '197725' => 1,
    '197726' => 1,
    '197727' => 1,
    '197729' => 1,
    '197733' => 1,
    '197734' => 1,
    '197735' => 1,
    '197737' => 1,
    '197740' => 1,
    '197741' => 1,
    '197743' => 1,
    '197744' => 1,
    '197746' => 1,
    '197750' => 1,
    '197751' => 1,
    '197752' => 1,
    '197753' => 1,
    '197754' => 1,
    '197755' => 1,
    '197756' => 1,
    '197757' => 1,
    '197758' => 1,
    '197759' => 1,
    '197760' => 1,
    '197761' => 1,
    '197762' => 1,
    '197763' => 1,
    '197764' => 1,
    '197767' => 1,
    '197768' => 1,
    '197769' => 1,
    '197770' => 1,
    '197771' => 1,
    '197772' => 1,
    '197773' => 1,
    '197776' => 1,
    '197777' => 1,
    '197778' => 1,
    '197779' => 1,
    '197780' => 1,
    '197781' => 1,
    '197782' => 1,
    '197783' => 1,
    '197785' => 1,
    '197786' => 1,
    '197788' => 1,
    '197790' => 1,
    '197791' => 1,
    '197792' => 1,
    '197793' => 1,
    '197794' => 1,
    '197795' => 1,
    '197796' => 1,
    '197797' => 1,
    '197798' => 1,
    '197799' => 1,
    '197800' => 1,
    '197802' => 1,
    '197803' => 1,
    '197804' => 1,
    '197805' => 1,
    '197806' => 1,
    '197807' => 1,
    '197808' => 1,
    '197809' => 1,
    '197810' => 1,
    '197811' => 1,
    '197812' => 1,
    '197813' => 1,
    '197815' => 1,
    '202-0074117-7856302' => 1,
    '202-0119170-4846750' => 1,
    '202-0133141-0247518' => 1,
    '202-0476016-8196358' => 1,
    '202-0648609-8619542' => 1,
    '202-0720081-8073121' => 1,
    '202-0737963-8860369' => 1,
    '202-0869951-9612331' => 1,
    '202-1016396-0737944' => 1,
    '202-1168360-1988347' => 1,
    '202-1205715-3647550' => 1,
    '202-1289327-7076319' => 1,
    '202-1637361-2630747' => 1,
    '202-1689082-2019542' => 1,
    '202-1847087-1987525' => 1,
    '202-1969551-5733146' => 1,
    '202-2156805-3725968' => 1,
    '202-2308211-8090740' => 1,
    '202-2428044-6172334' => 1,
    '202-2480116-6538753' => 1,
    '202-2740261-0652324' => 1,
    '202-2745231-3355567' => 1,
    '202-2767304-1008317' => 1,
    '202-2888828-4022768' => 1,
    '202-2955160-1933936' => 1,
    '202-3252303-1361915' => 1,
    '202-3301735-8376339' => 1,
    '202-3304748-9485904' => 1,
    '202-3476542-2581957' => 1,
    '202-3486045-9405139' => 1,
    '202-3651548-4770736' => 1,
    '202-3675485-9420347' => 1,
    '202-3683462-2709124' => 1,
    '202-3711498-4770766' => 1,
    '202-3773206-5428346' => 1,
    '202-3803638-8757912' => 1,
    '202-3834429-6580341' => 1,
    '202-3840934-9203537' => 1,
    '202-3930722-1280331' => 1,
    '202-3954995-3828369' => 1,
    '202-3985878-1705116' => 1,
    '202-4057607-4847503' => 1,
    '202-4166947-2593944' => 1,
    '202-4298639-1886762' => 1,
    '202-4313756-9429160' => 1,
    '202-4322423-2471567' => 1,
    '202-4344068-0829927' => 1,
    '202-4463165-2569128' => 1,
    '202-4658438-7898754' => 1,
    '202-4686094-5093934' => 1,
    '202-4792797-7877953' => 1,
    '202-5030914-8781951' => 1,
    '202-5106433-0467508' => 1,
    '202-5162646-9961115' => 1,
    '202-5266258-1230724' => 1,
    '202-5279417-5594718' => 1,
    '202-5342223-4813959' => 1,
    '202-5390086-0173121' => 1,
    '202-5417943-3239519' => 1,
    '202-5424156-1197923' => 1,
    '202-5518325-0180325' => 1,
    '202-5537274-0627556' => 1,
    '202-5616230-4297915' => 1,
    '202-5623434-7079515' => 1,
    '202-5712370-1102704' => 1,
    '202-5835382-4857157' => 1,
    '202-5878706-9206713' => 1,
    '202-6006241-1409944' => 1,
    '202-6028048-6967568' => 1,
    '202-6035752-4057916' => 1,
    '202-6201640-4033944' => 1,
    '202-6659348-8759522' => 1,
    '202-6783645-3221158' => 1,
    '202-7025370-8281119' => 1,
    '202-7032075-3987537' => 1,
    '202-7197776-8323540' => 1,
    '202-7260247-7553163' => 1,
    '202-7600472-0155529' => 1,
    '202-7988421-9378751' => 1,
    '202-8109344-3361921' => 1,
    '202-8167679-5869907' => 1,
    '202-8203524-9305927' => 1,
    '202-8210256-0073146' => 1,
    '202-8571644-2608313' => 1,
    '202-8658774-7850732' => 1,
    '202-8708919-6709164' => 1,
    '202-8724319-9135516' => 1,
    '202-8856878-2938733' => 1,
    '202-8907036-3241955' => 1,
    '202-9152827-8912329' => 1,
    '202-9183786-1748309' => 1,
    '202-9194044-7093105' => 1,
    '202-9276880-5364365' => 1,
    '202-9316752-9805946' => 1,
    '202-9374255-6768335' => 1,
    '202-9541072-9663509' => 1,
    '202-9623520-7040348' => 1,
    '202-9712504-9594701' => 1,
    '202-9729374-5208310' => 1,
    '202-9847225-9005968' => 1,
    '202-9893295-7377168' => 1,
    '203-0090129-9792347' => 1,
    '203-0095440-1413934' => 1,
    '203-0132872-4639505' => 1,
    '203-0297484-2487576' => 1,
    '203-0411406-2805944' => 1,
    '203-0462004-9637961' => 1,
    '203-0614239-6708315' => 1,
    '203-0801587-3317124' => 1,
    '203-0846425-2483545' => 1,
    '203-0890759-7053937' => 1,
    '203-1101419-3320337' => 1,
    '203-1106955-4885948' => 1,
    '203-1113521-8406759' => 1,
    '203-1708411-4861905' => 1,
    '203-1713630-6747512' => 1,
    '203-1841992-9671565' => 1,
    '203-1842038-3369141' => 1,
    '203-1894255-1624369' => 1,
    '203-1918387-2961112' => 1,
    '203-2058046-0738726' => 1,
    '203-2316449-8469113' => 1,
    '203-2516546-4989918' => 1,
    '203-2660938-0087563' => 1,
    '203-2726793-4474761' => 1,
    '203-2752952-1888338' => 1,
    '203-3084074-2947505' => 1,
    '203-3190967-6157167' => 1,
    '203-3332874-6257922' => 1,
    '203-3459969-9978761' => 1,
    '203-3543905-1084366' => 1,
    '203-3613663-4752331' => 1,
    '203-3723909-0394707' => 1,
    '203-3880843-4057117' => 1,
    '203-4164873-6628327' => 1,
    '203-4310437-6933117' => 1,
    '203-4463437-8115523' => 1,
    '203-4513194-8593111' => 1,
    '203-4601437-2829141' => 1,
    '203-4762906-9620361' => 1,
    '203-4841667-2437930' => 1,
    '203-4882196-0554731' => 1,
    '203-5100094-8749157' => 1,
    '203-5132707-7173149' => 1,
    '203-5150090-8697163' => 1,
    '203-5370094-0931553' => 1,
    '203-5376329-1884342' => 1,
    '203-5437480-5662713' => 1,
    '203-5439203-0742769' => 1,
    '203-5447873-2837125' => 1,
    '203-5465756-7352313' => 1,
    '203-5667266-2291525' => 1,
    '203-5722176-3143526' => 1,
    '203-5970125-5416313' => 1,
    '203-5979644-4802768' => 1,
    '203-6152349-8889907' => 1,
    '203-6196351-3892368' => 1,
    '203-6374760-0869144' => 1,
    '203-6484684-2918749' => 1,
    '203-6661984-3659565' => 1,
    '203-6767230-5323517' => 1,
    '203-6793703-0973904' => 1,
    '203-6826447-3974734' => 1,
    '203-6866913-9718743' => 1,
    '203-7212904-2909919' => 1,
    '203-7358167-3189945' => 1,
    '203-7552664-6179509' => 1,
    '203-7615665-2856349' => 1,
    '203-7736046-2999529' => 1,
    '203-7804948-4785129' => 1,
    '203-8089495-4763519' => 1,
    '203-8254296-7041966' => 1,
    '203-8278569-1768313' => 1,
    '203-8319295-8344362' => 1,
    '203-8366771-8388351' => 1,
    '203-8612458-1191520' => 1,
    '203-8734543-2533157' => 1,
    '203-8783675-3124351' => 1,
    '203-8797600-9305942' => 1,
    '203-8871550-0046711' => 1,
    '203-8995293-5781933' => 1,
    '203-9050888-6835511' => 1,
    '203-9074560-0290701' => 1,
    '203-9270964-3143510' => 1,
    '203-9307359-8577145' => 1,
    '203-9343252-1982740' => 1,
    '203-9414583-2139552' => 1,
    '203-9512963-9345128' => 1,
    '203-9601914-4911537' => 1,
    '203-9605686-9376311' => 1,
    '203-9910829-8649101' => 1,
    '203-9918418-6969151' => 1,
    '203-9935498-9840316' => 1,
    '204-0068544-3037103' => 1,
    '204-0075702-2182753' => 1,
    '204-0175834-9936376' => 1,
    '204-0257093-8893165' => 1,
    '204-0377825-7893159' => 1,
    '204-0813935-6409146' => 1,
    '204-0869422-3044350' => 1,
    '204-0918384-6361130' => 1,
    '204-1098792-1569118' => 1,
    '204-1514339-7710717' => 1,
    '204-1560347-7787555' => 1,
    '204-1672309-0863550' => 1,
    '204-1713514-6991554' => 1,
    '204-1931942-4634710' => 1,
    '204-1948326-5079512' => 1,
    '204-2048421-0405931' => 1,
    '204-2245299-6415548' => 1,
    '204-2283477-6660319' => 1,
    '204-2572789-3357947' => 1,
    '204-2572806-1545116' => 1,
    '204-2778334-8385112' => 1,
    '204-2780181-9271563' => 1,
    '204-2867389-9284354' => 1,
    '204-2911674-8174722' => 1,
    '204-2954823-2639538' => 1,
    '204-3012068-7532316' => 1,
    '204-3030401-1444334' => 1,
    '204-3190940-8205931' => 1,
    '204-3271868-0673930' => 1,
    '204-3552009-5993150' => 1,
    '204-3562715-8799540' => 1,
    '204-3759421-7586734' => 1,
    '204-3973610-4669963' => 1,
    '204-4020350-8454739' => 1,
    '204-4072314-1633132' => 1,
    '204-4075978-7627543' => 1,
    '204-4100914-2601941' => 1,
    '204-4107291-0878715' => 1,
    '204-4316789-5912324' => 1,
    '204-4336939-5886741' => 1,
    '204-4354433-7956338' => 1,
    '204-4375281-5276352' => 1,
    '204-4401212-8428348' => 1,
    '204-4543796-2430728' => 1,
    '204-4658917-2777152' => 1,
    '204-4950916-9737147' => 1,
    '204-5020207-2750709' => 1,
    '204-5081648-5767523' => 1,
    '204-5107033-5162767' => 1,
    '204-5175705-8537155' => 1,
    '204-5182421-1708308' => 1,
    '204-5261118-4327511' => 1,
    '204-5279281-0607531' => 1,
    '204-5392815-5869155' => 1,
    '204-5469924-7677964' => 1,
    '204-5472608-6516344' => 1,
    '204-5517292-5193919' => 1,
    '204-5646799-6156308' => 1,
    '204-5768680-8180330' => 1,
    '204-5799512-3267564' => 1,
    '204-5828177-9997107' => 1,
    '204-5892898-4062725' => 1,
    '204-6046918-9746767' => 1,
    '204-6177972-1121926' => 1,
    '204-6339761-9046700' => 1,
    '204-6452263-3253963' => 1,
    '204-6477203-0252343' => 1,
    '204-6506602-2287540' => 1,
    '204-6616635-5739543' => 1,
    '204-6808799-3942735' => 1,
    '204-6843109-4989142' => 1,
    '204-6955046-3253132' => 1,
    '204-7141408-3106756' => 1,
    '204-7176516-4153912' => 1,
    '204-7319868-7339552' => 1,
    '204-7321917-5302741' => 1,
    '204-7401425-7367542' => 1,
    '204-7507655-2740349' => 1,
    '204-7707789-1899522' => 1,
    '204-7772827-1064334' => 1,
    '204-7784731-0318735' => 1,
    '204-7888697-4980322' => 1,
    '204-8006797-9153144' => 1,
    '204-8107116-9413937' => 1,
    '204-8243059-5656306' => 1,
    '204-8339280-4399538' => 1,
    '204-8379761-3913954' => 1,
    '204-8404814-1189142' => 1,
    '204-8458399-1753115' => 1,
    '204-8568259-8264368' => 1,
    '204-8619626-0487566' => 1,
    '204-8693626-6750758' => 1,
    '204-8701003-5741131' => 1,
    '204-8722338-8053122' => 1,
    '204-8732466-6258722' => 1,
    '204-8767767-1011513' => 1,
    '204-9106819-5175536' => 1,
    '204-9444771-2583500' => 1,
    '204-9523066-0856348' => 1,
    '204-9556316-6065936' => 1,
    '204-9717185-3643501' => 1,
    '204-9751124-8080365' => 1,
    '204-9865586-4392328' => 1,
    '204-9914206-3692357' => 1,
    '204-9926941-6098741' => 1,
    '204-9932144-5057950' => 1,
    '205-0078089-6824301' => 1,
    '205-0107159-9201903' => 1,
    '205-0186074-3704314' => 1,
    '205-0257804-6879574' => 1,
    '205-0392273-8899561' => 1,
    '205-0477552-1008331' => 1,
    '205-0504546-0273169' => 1,
    '205-0576068-6578710' => 1,
    '205-0847562-1966711' => 1,
    '205-0981731-5139568' => 1,
    '205-1127728-1366760' => 1,
    '205-1400629-6616301' => 1,
    '205-1407021-5204309' => 1,
    '205-1549629-0492328' => 1,
    '205-1646601-3364335' => 1,
    '205-1754384-3552309' => 1,
    '205-1825284-4609925' => 1,
    '205-1868421-5971556' => 1,
    '205-1954335-9236334' => 1,
    '205-2055515-1432305' => 1,
    '205-2108123-7755521' => 1,
    '205-2122265-2261148' => 1,
    '205-2368230-8533944' => 1,
    '205-2666418-9592302' => 1,
    '205-3079359-9785104' => 1,
    '205-3093953-7381937' => 1,
    '205-3155989-8470709' => 1,
    '205-3305196-9452348' => 1,
    '205-3312462-0861147' => 1,
    '205-3350568-2792338' => 1,
    '205-3356819-9577920' => 1,
    '205-3501581-4085126' => 1,
    '205-3506924-4361903' => 1,
    '205-3650442-5093926' => 1,
    '205-3700866-0825153' => 1,
    '205-3712495-5735568' => 1,
    '205-3718600-5490734' => 1,
    '205-3978622-4998731' => 1,
    '205-4075549-6321931' => 1,
    '205-4312623-2328353' => 1,
    '205-4314412-7977160' => 1,
    '205-4341543-9696317' => 1,
    '205-4388975-4721937' => 1,
    '205-4418738-0892311' => 1,
    '205-4588669-0316330' => 1,
    '205-4772712-6653906' => 1,
    '205-4794490-9680330' => 1,
    '205-4809147-7266756' => 1,
    '205-5096880-4969916' => 1,
    '205-5159174-9061933' => 1,
    '205-5334261-7732326' => 1,
    '205-5393213-3836336' => 1,
    '205-5896991-1227513' => 1,
    '205-6048692-4148351' => 1,
    '205-6280004-0509133' => 1,
    '205-6315648-8353917' => 1,
    '205-6349562-6482756' => 1,
    '205-6552023-7872347' => 1,
    '205-6659314-5859526' => 1,
    '205-6856611-5248356' => 1,
    '205-6951597-6427549' => 1,
    '205-7011590-8466702' => 1,
    '205-7015564-8894740' => 1,
    '205-7049310-2093114' => 1,
    '205-7267775-0765153' => 1,
    '205-7424717-4444308' => 1,
    '205-7562308-2773962' => 1,
    '205-7664005-2110767' => 1,
    '205-7729983-2216357' => 1,
    '205-7777517-7540307' => 1,
    '205-7778728-5434763' => 1,
    '205-7827170-1803523' => 1,
    '205-7876586-2600341' => 1,
    '205-8065954-2379546' => 1,
    '205-8188920-2354711' => 1,
    '205-8341222-2190741' => 1,
    '205-8355528-8470748' => 1,
    '205-8359696-5249954' => 1,
    '205-8604856-2682764' => 1,
    '205-8626671-0053941' => 1,
    '205-8773109-4148343' => 1,
    '205-8809208-7436333' => 1,
    '205-8826643-1401118' => 1,
    '205-8846451-3405123' => 1,
    '205-8855471-5807552' => 1,
    '205-8864918-8822729' => 1,
    '205-8865149-7201169' => 1,
    '205-8974497-4755504' => 1,
    '205-9010569-9785940' => 1,
    '205-9101037-3159545' => 1,
    '205-9331556-8259522' => 1,
    '205-9395260-2921134' => 1,
    '205-9411733-1461163' => 1,
    '205-9473509-1579511' => 1,
    '205-9673212-0481957' => 1,
    '205-9772163-4185960' => 1,
    '205-9919793-3950734' => 1,
    '205-9941856-8395513' => 1,
    '206-0016305-4201968' => 1,
    '206-0087388-7238729' => 1,
    '206-0103904-8780374' => 1,
    '206-0220803-8525901' => 1,
    '206-0573013-7823511' => 1,
    '206-0623397-4501907' => 1,
    '206-0635351-5803539' => 1,
    '206-0771641-8389967' => 1,
    '206-0911336-2593143' => 1,
    '206-1124252-9753168' => 1,
    '206-1350370-9112312' => 1,
    '206-1369075-2957947' => 1,
    '206-1635649-6717165' => 1,
    '206-1713233-1422759' => 1,
    '206-1738834-0618768' => 1,
    '206-1769483-6062737' => 1,
    '206-1972237-3772364' => 1,
    '206-2005125-6040356' => 1,
    '206-2035136-0313964' => 1,
    '206-2039813-3300358' => 1,
    '206-2095650-1026743' => 1,
    '206-2117862-4620329' => 1,
    '206-2205437-9309926' => 1,
    '206-2225219-4068347' => 1,
    '206-2291343-9856353' => 1,
    '206-2527549-4062702' => 1,
    '206-2605447-7325139' => 1,
    '206-2709048-4479532' => 1,
    '206-2866138-5807517' => 1,
    '206-2876888-8003563' => 1,
    '206-2968024-7101927' => 1,
    '206-3053542-0953125' => 1,
    '206-3162255-6327516' => 1,
    '206-3304403-1238747' => 1,
    '206-3379651-3307554' => 1,
    '206-3451508-8320306' => 1,
    '206-3546918-8899502' => 1,
    '206-3685913-1776363' => 1,
    '206-3693594-0666735' => 1,
    '206-3924872-4020311' => 1,
    '206-4035711-8969963' => 1,
    '206-4603529-1676343' => 1,
    '206-4632107-7501964' => 1,
    '206-4725567-6938700' => 1,
    '206-4780658-9497163' => 1,
    '206-4851594-5665149' => 1,
    '206-5076861-0218754' => 1,
    '206-5257062-4533927' => 1,
    '206-5413555-7280325' => 1,
    '206-5451318-0192350' => 1,
    '206-5540839-9897943' => 1,
    '206-5783826-5209964' => 1,
    '206-5909554-6503557' => 1,
    '206-6018023-6390749' => 1,
    '206-6151497-3004350' => 1,
    '206-6173271-0641106' => 1,
    '206-6195927-5055512' => 1,
    '206-6199973-0960323' => 1,
    '206-6234703-5625934' => 1,
    '206-6571708-1135521' => 1,
    '206-6699969-6014706' => 1,
    '206-6705479-3185107' => 1,
    '206-6766929-0968322' => 1,
    '206-6780117-1025907' => 1,
    '206-6783713-6981135' => 1,
    '206-6957018-3418717' => 1,
    '206-6973411-6669138' => 1,
    '206-6993627-7973951' => 1,
    '206-7320351-2946742' => 1,
    '206-7524296-5017931' => 1,
    '206-7638628-0593964' => 1,
    '206-7879591-7779523' => 1,
    '206-8082067-1637905' => 1,
    '206-8207704-2543543' => 1,
    '206-8208689-5032352' => 1,
    '206-8284055-3531500' => 1,
    '206-8345585-9975533' => 1,
    '206-8674823-4161904' => 1,
    '206-8860665-4301124' => 1,
    '206-8880654-0980341' => 1,
    '206-8956709-9777968' => 1,
    '206-9157616-4040350' => 1,
    '206-9189277-8096346' => 1,
    '206-9270810-2720362' => 1,
    '206-9385643-7186761' => 1,
    '206-9558647-1008351' => 1,
    '206-9620301-0133101' => 1,
    '206-9910670-0343532' => 1,
    '206-9910860-3653102' => 1,
    '206-9934346-3837920' => 1,
    '206-9979141-8380361' => 1,
    'FW-2301' => 1,
    'FW-2302' => 1,
    'FW-2303' => 1,
    'PS-34596' => 1,
    'PS-34597' => 1,
    'PS-34598' => 1,
    'TSH9PZ' => 1,
    'TSHC7Q' => 1,
    'TSHFWM' => 1,
    'TSHFZG' => 1,
    'TSHGSY' => 1,
    'TSHJ5W' => 1,
    'TSHPSW' => 1,
    'TSHRS7' => 1,
    '206-0713830-5722726' => 1,
    '1249804' => 1,
];

// $tmp = [];
// foreach ($json_barcode as $json_str) {
//     $rec = json_decode($json_str, true);
    
//     if (isset($barcode_lookup[$rec['orderID']])) {
//         $tmp[] = $json_str;
//     }
// }
// $json_barcode = implode("\n", $tmp);

// echo '<pre style="background:#111; color:#b5ce28; font-size:11px;">'; print_r($json_barcode); echo '</pre>'; die();


$orderID_len = 0;
$courier_len = 0;
$count = 0;
$sql = [];
$sql[] = "INSERT INTO `barcode` (`barcode`,`orderId`,`platform`,`generatedTime`,`statusTime`,`status`,`courier`) VALUES";
foreach ($json_barcode as $i => $json_rec) {
    $rec = json_decode($json_rec, true);
    
    switch ($rec['orderSource']) {
        case 'amazon':
            $source = 'am';
            break;
        case 'ebay':
            $source = 'ee';
            break;
        case 'ebay_prosalt':
            $source = 'ep';
            break;
        case 'floorworld':
            $source = 'ef';
            break;
        case 'onbuy':
            $source = 'on';
            break;
        case 'website':
            $source = 'we';
            break;
        case 'manual':
            $source = 'ma';
            break;
        default:
            $source = 'XX';
            break;
    }
    
    $barcode = $rec['barcode'];
    $orderID = $rec['orderID'];
    // $source  = $rec['orderSource'];
    $gTime   = $rec['generatedTime'];
    $sTime   = $rec['statusTime'];
    $status  = substr($rec['status'], 0,1);
    $courier = $rec['courier'];
    
    
    if (strlen($orderID) > $orderID_len) {
        $orderID_len = strlen($orderID);
    }
    if (strlen($courier) > $courier_len) {
        $courier_len = strlen($courier);
    }
    
    if (isset($barcode_lookup[$orderID])) {
        $sql[] = "\n('$barcode','$orderID','$source','$gTime','$sTime','$status','$courier'),";
    }
}
$sql_str = substr(implode('', $sql), 0,-1).';';
$db_mysql->query($sql_str);

// echo '<pre style="background:#111; color:#b5ce28; font-size:11px;">'; print_r($sql_str); echo '</pre>'; die();




try {
    if ($db_mysql->exec("DROP TABLE IF EXISTS lookup_title_variation_url_price")) {
        echo "Deleted lookup_title_variation_url_price table.<br>";
    }
    
    $sql ="CREATE TABLE `lookup_title_variation_url_price` (
        `autoInc`   int AUTO_INCREMENT,
        `platform`  char(2) NOT NULL,
        -- `int`       timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
        `date`      int NOT NULL,
        `sku`       varchar(60) NOT NULL,
        `title`     varchar(255) NOT NULL,
        `variation` varchar(255) NOT NULL,
        `url` varchar(255) NOT NULL,
        `price`     double NOT NULL,
        PRIMARY KEY(`autoInc`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
    
    echo "Create lookup_title_variation_url_price table.<br>";
    $db_mysql->exec($sql);
    
} catch (PDOException $e) {
    echo $e->getMessage();
}

foreach ($tables as $tbl) {
    try {
        if ($db_mysql->exec("DROP TABLE IF EXISTS {$tbl}_orders")) {
            echo "Deleted {$tbl}_orders table.<br>";
        }
        
        $data = [];
        $data[] = '`autoInc` int(8) NOT NULL AUTO_INCREMENT,';
        $data[] = '`orderId` varchar(20) UNIQUE NOT NULL,';
        $data[] = '`total` double NOT NULL,';
        $data[] = '`currency` char(3) NOT NULL,';
        $data[] = '`date` int NOT NULL,';
        $data[] = '`buyer` varchar(255) NOT NULL,';
        $data[] = '`phone` varchar(30) NOT NULL,';
        $data[] = '`email` varchar(50) NOT NULL,';
        if ('amazon' == $tbl) {$data[] = '`isPrime` tinyint(4) DEFAULT NULL,';}
        $data[] = '`service` varchar(14) NOT NULL,';
        $data[] = '`shippingName` varchar(255) NOT NULL,';
        $data[] = '`addressLine1` varchar(255) NOT NULL,';
        $data[] = '`addressLine2` varchar(255) NOT NULL,';
        $data[] = '`city` varchar(60) NOT NULL,';
        $data[] = '`county` varchar(60) NOT NULL,';
        $data[] = '`countryCode` char(2) NOT NULL,';
        $data[] = '`postcode` varchar(9) NOT NULL,';
        $data[] = '`message` varchar(255) NOT NULL DEFAULT "",';
        $data[] = 'PRIMARY KEY (`autoInc`)';
        $data_str = implode('', $data);
        
        $sql ="CREATE TABLE IF NOT EXISTS {$tbl}_orders($data_str) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
        
        echo "Create {$tbl}_orders table.<br>";
        $db_mysql->exec($sql);
        
        
        if ($db_mysql->exec("DROP TABLE IF EXISTS {$tbl}_items")) {
            echo "Deleted {$tbl}_items table.<br>";
        }
        
        $data = [];
        $data[] = '`autoInc` int(8) NOT NULL AUTO_INCREMENT,';
        $data[] = '`orderId` varchar(20) NOT NULL,';
        if ('ebay' == $tbl || 'ebay_prosalt' == $tbl || 'floorworld' == $tbl) {$data[] = '`ebayOrderId` varchar(20) NOT NULL,';}
        $data[] = '`itemId` varchar(20) NOT NULL,';
        $data[] = '`sku` varchar(60) NOT NULL,';
        $data[] = '`qty` int(3) NOT NULL,';
        $data[] = '`shipping` double NOT NULL,';
        $data[] = 'PRIMARY KEY (`autoInc`)';
        $data_str = implode('', $data);
        
        $sql ="CREATE TABLE IF NOT EXISTS {$tbl}_items($data_str) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
        
        echo "Create {$tbl}_items table.<br>";
        $db_mysql->exec($sql);
        
    } catch (PDOException $e) {
        echo $e->getMessage();
    }
}

/*
SFPs:               isprime| service   | courier
------------------------------------------------------
026-3017918-3529151 | true | Standard  | 1 × HI
026-4359585-7926725 | true | Standard  | SUR-H-4.99 (1)
026-6802674-1742738 |  "        "           "
026-6865410-6229961 | true | NextDay   | 1 × SFP
026-8788080-7083512 |  "        "           "
202-1205715-3647550 |  "        "           "
202-2888828-4022768 |  "        "           "
202-3683462-2709124 |  "        "           "
202-5390086-0173121 |  "        "           "
202-7025370-8281119 | true | Standard  | 1 × HI
202-7197776-8323540 | true | NextDay   | 1 × SFP
202-8724319-9135516 | true | SecondDay | 1 × SFP
203-0846425-2483545 | true | NextDay   | 1 × SFP
203-2660938-0087563 | true | Standard  | 1 × HI
203-3723909-0394707 | true | NextDay   | 1 × SFP
203-3880843-4057117 |  "        "           "
203-4463437-8115523 |  "        "           "
203-9918418-6969151 |  "        "           "
204-0257093-8893165 |  "        "           "
*/

$json_undispatched = file('data/json_undispatched.php', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

$orderIDs = [];
foreach ($json_undispatched as $i => $json_rec) {
    $json_decode = json_decode($json_rec, true);
    
    $orderIDs[$i]['orderID'] = $json_decode['orderID'];
    $orderIDs[$i]['source']  = $json_decode['source'];
    $orderIDs[$i]['channel'] = $json_decode['channel'];
    
    if ('prosalt' == $json_decode['channel']) {
        $orderIDs[$i]['tbl'] = $json_decode['source'] .'_'. $json_decode['channel'];
    }
    elseif ('floorworld' == $json_decode['channel']) {
        $orderIDs[$i]['tbl'] = $json_decode['channel'];
    }
    else {
        $orderIDs[$i]['tbl'] = $json_decode['source'];
    }
}


$tmp = [];
foreach ($orderIDs as $rec) {
    $tbl = $rec['tbl'];
    $tmp[$tbl][] = $rec['orderID'];
}
$orderIDs = $tmp;


$where_in = [];
foreach ($orderIDs as $source => $vals) {
    $where_in[$source] = implode("','", $vals);
}

$db_sqlite = new PDO('sqlite:data/api_orders.db3');

$api_orders = [];
foreach ($where_in as $platform => $orderIDs) {
    $sql = "SELECT * FROM {$platform}_orders WHERE `orderId` IN ('$orderIDs')";
    
    $results = $db_sqlite->query($sql);
    $api_orders["{$platform}_orders"] = $results->fetchAll(PDO::FETCH_ASSOC);
    
    $tmp = [];
    foreach ($api_orders["{$platform}_orders"] as $i => $rec) {
        foreach ($rec as $key => $n_a) {
            $rec[$key] = str_replace("'", "\'", $rec[$key]);
            
            if ('date' == $key) {
                $rec[$key] = preg_replace('/\.\d{3}Z$/', '', $rec[$key]);
                $rec[$key] = str_replace('T', ' ', $rec[$key]);
                
                $rec[$key] = strtotime(date($rec[$key]));
            }
            if ('isprime' == $key) {
                $rec[$key] = 'false' == $rec[$key] ? '0' : '1';
            }
        }
        
        $api_orders["{$platform}_orders"][$i] = $rec;
    }
    
    $sql = "SELECT * FROM {$platform}_items WHERE `orderId` IN ('$orderIDs')";
    $results = $db_sqlite->query($sql);
    $api_orders["{$platform}_items"] = $results->fetchAll(PDO::FETCH_ASSOC);
    
    $tmp = [];
    foreach ($api_orders["{$platform}_items"] as $i => $rec) {
        foreach ($rec as $key => $n_a) {
            if (!is_null($rec[$key])) {
                $rec[$key] = str_replace("'", "\'", $rec[$key]);
            }
            
            if ('shipping' == $key) {
                $rec[$key] = '' == $rec[$key] ? '0' : $rec[$key];
            }
        }
        
        $api_orders["{$platform}_items"][$i] = $rec;
    }
}


$orders_flds = "`orderId`,`total`,`currency`,`date`,`buyer`,`phone`,`email`,`service`,`shippingName`,`addressLine1`,`addressLine2`,`city`,`county`,`countryCode`,`postcode`,`message`";
$orders_flds_a = "`orderId`,`total`,`currency`,`date`,`buyer`,`phone`,`email`,`isPrime`,`service`,`shippingName`,`addressLine1`,`addressLine2`,`city`,`county`,`countryCode`,`postcode`";

$items_flds = "`orderId`,`itemId`,`sku`,`qty`,`shipping`";
$items_flds_e = "`orderId`,`ebayOrderId`,`itemId`,`sku`,`qty`,`shipping`";

$lookup_sku_dates = [];
$lookup_sku_title_variation_price = [];
foreach ($api_orders as $tbl => $arr) {
    // if (
    //     'amazon_orders' == $tbl || 'amazon_items' == $tbl ||
    //     'ebay_orders' == $tbl || 'ebay_items' == $tbl ||
    //     'ebay_prosalt_orders' == $tbl || 'ebay_prosalt_items' == $tbl ||
    //     'floorworld_orders' == $tbl || 'floorworld_items' == $tbl ||
    //     'onbuy_orders' == $tbl || 'onbuy_items' == $tbl ||
    //     'website_orders' == $tbl || 'website_items' == $tbl
    // ) {
    if ('orders' == substr($tbl, -6)) {
        $flds = 'amazon_orders' != $tbl ? $orders_flds : $orders_flds_a;
    }
    elseif ('ebay_items' == $tbl || 'ebay_prosalt_items' == $tbl || 'floorworld_items' == $tbl) {
        $flds = $items_flds_e;
    }
    elseif ('_items' == substr($tbl, -6)) {
        $flds = $items_flds;
    }
    
    $insert = [];
    $insert_sku_title_variation_price = [];
    foreach ($arr as $i => $recs) {
        if (!$i) {
            $insert[] = "INSERT INTO `$tbl` ($flds) VALUES ";
            $insert_sku_title_variation_price[] = "INSERT INTO `lookup_title_variation_url_price` (`platform`,`date`,`sku`,`title`,`variation`,`url`,`price`) VALUES ";
        }
        
        if (isset($recs['date'])) {
            $lookup_sku_dates[$recs['orderId']] = [
                'date' => $recs['date'],
            ];
        }
        
        if ('_items' == substr($tbl, -6)) {
            switch (substr($tbl, 0,-6)) {
                case 'amazon':
                    $platform = 'am';
                    break;
                case 'ebay':
                    $platform = 'ee';
                    break;
                case 'ebay_prosalt':
                    $platform = 'ep';
                    break;
                case 'floorworld':
                    $platform = 'ef';
                    break;
                case 'onbuy':
                    $platform = 'on';
                    break;
                case 'website':
                    $platform = 'we';
                    break;
                default:
                    $platform = 'XX';
                    break;
            }
            
            $ts = $lookup_sku_dates[$recs['orderId']]['date'];
            
            $price = $recs['price'] / $recs['qty'];
            $tvp = $recs['title'].$recs['variations'].$price;
            $url = 'website_items' != $tbl ? '' : $recs['url'];
            
            if (!isset($lookup_sku_title_variation_price[$platform.$recs['sku']])) {
                $lookup_sku_title_variation_price[$platform.$recs['sku']] = hash("sha256", $tvp);
                $insert_sku_title_variation_price[] = "('$platform','$ts','{$recs['sku']}','{$recs['title']}','{$recs['variations']}','$url','$price'),";
            }
            elseif (hash("sha256", $tvp) != $lookup_sku_title_variation_price[$platform.$recs['sku']]) {
                $insert_sku_title_variation_price[] = "('$platform','$ts','{$recs['sku']}','{$recs['title']}','{$recs['variations']}','$url','$price'),";
            }
            
            // A sha256 hash function is used because it's much more efficient to compare 64 bit hashes, than 100-200 character (title, variations, price)
            // $lookup_sku_title_variation_price = [
            //     'amPlayground-Sand_25_3'           => '4b097a074fdac0a4758187c95efed33164ffefe945b8ea113888b4abe8b35ac1',
            //     'amDead_Sea_Table_(Bath)-20kg-tub' => '97137a12fbb5092b3c0f0ac5ca91204f685c58feb5b0d80caa7e7cc7681b28b6',
            //     'amsplitcane_600_10'               => '9568f0388e7a396019ebe6913ba3c4c60d31dad7633db6d96ebb44709cb1fb47',
            //     'am9N-OXS8-O0LD'                   => 'b1f06e9b3e5afdeeba2402ca6220bb944e2478fbbd4b1e46c3136c4925581312',
            // ]
            
            
            unset($recs['title']);
            unset($recs['variations']);
            unset($recs['price']);
            
            if (isset($recs['url'])) {unset($recs['url']);}
        }
        
        $insert[] = "('".implode("','", array_values($recs))."'),";
    }
    
    $sql_insert_sku_title_variation_price = substr(implode("", $insert_sku_title_variation_price), 0,-1).';';
    $sql_insert = substr(implode("", $insert), 0,-1).';';
    
    // $sql_insert_sku_title_variation_price = str_replace(") VALUES (", ") VALUES\n(", $sql_insert_sku_title_variation_price);
    // $sql_insert_sku_title_variation_price = str_replace("),(", "),\n(", $sql_insert_sku_title_variation_price);
    // echo '<pre style="background:#111; color:#b5ce28; font-size:11px;">'; print_r($sql_insert_sku_title_variation_price); echo '</pre>';
    
    $sql_insert = str_replace(") VALUES (", ") VALUES\n(", $sql_insert);
    $sql_insert = str_replace("),(", "),\n(", $sql_insert);
    echo '<pre style="background:#111; color:#b5ce28; font-size:11px;">'; print_r($sql_insert); echo '</pre>';
    
    // TRUNCATE TABLE `lookup_title_variation_url_price`;
    // TRUNCATE TABLE `amazon_items`;
    
    if ('_items' == substr($tbl, -6)) {
        $db_mysql->query($sql_insert_sku_title_variation_price);
    }
    
    $db_mysql->query($sql_insert);
}
